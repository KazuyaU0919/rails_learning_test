<% breadcrumb :quizzes %>
<% breadcrumb :quiz, @quiz %>
<% breadcrumb :quiz_section_public, @quiz, @section %>
<% breadcrumb :quiz_question, @quiz, @section, @question %>
<%= render "shared/breadcrumbs" %>

<div class="mx-auto w-full max-w-3xl pt-2 px-4 md:px-6 lg:px-8" data-controller="code-highlight">
  <% content_for :title, "#{@section.heading} - 問題" %>
  <p class="text-sm text-slate-500 mb-2">
    <%= link_to @quiz.title, quiz_path(@quiz) %> / <%= @section.heading %>
  </p>

  <div class="rounded ring-1 ring-slate-200 p-4 bg-white">
    <p class="text-slate-500 text-xl">Q<%= @question.position %></p>

    <!-- 問題文（リッチ表示） -->
    <article class="content-body prose break-all w-full md:break-words">
      <%= rich_html(@question.question) %>
    </article>

    <!-- ▼ 各選択肢を“押した瞬間に送信”するボタンに変更 -->
    <div class="space-y-2 pt-2">
      <% (1..4).each do |i| %>
        <% label = @question.public_send("choice#{i}") %>
        <%= button_to label,
              answer_quiz_section_question_path(@quiz, @section, @question),
              params: { choice: i },
              method: :post,
              form: { data: { turbo: false } },
              class: "btn-choice w-full text-left" %>
      <% end %>
    </div>
  </div>

  <% if can_edit?(@question) %>
    <div class="flex justify-end my-3">
      <%= link_to "この問題を編集",
            edit_quiz_section_question_path(@quiz, @section, @question),
            class: "btn-change is-edit" %>
    </div>
  <% end %>
</div>
