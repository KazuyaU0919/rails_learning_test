<% breadcrumb :books %>
<% breadcrumb :book, @book %>
<% breadcrumb :book_section, @book, @section %>
<%= render "shared/breadcrumbs" %>

<div class="mx-auto w-full max-w-3xl px-4 md:px-6 lg:px-8" data-controller="code-highlight">
  <nav class="mb-6 text-sm">
    <%= link_to "← #{@book.title} に戻る", book_path(@book), class: "text-slate-600 hover:underline" %>
  </nav>

  <% if can_edit?(@section) %>
    <div class="flex justify-end mb-4">
      <%= link_to "編集", edit_book_section_path(@book, @section),
            class: "btn-change is-edit" %>
    </div>
  <% end %>

  <h1 class="text-2xl font-bold mb-3">
    <span class="text-slate-400 mr-2"><%= @section.position %>.</span>
    <%= @section.heading %>
  </h1>

  <!-- ★ ここがハイライト対象（content-body） -->
  <article class="content-body prose break-all md:break-words">
    <%= render_section_content(@section) %>
  </article>

  <!-- ===== シェア & クイズ遷移ボタン ===== -->
  <h1 class="mt-12 text-2xl font-semibold">次の章に行く前に...</h1>
  <div class="text-center space-y-3"
       data-controller="share"
       data-share-url-value="<%= books_url %>">
    <% if @section.quiz_section.present? %>
      <div class="mt-4 p-5 rounded-xl ring-1 ring-slate-200 bg-white">
        <p class="text-xl font-semibold mt-2 mb-3">この章で学んだ知識を覚えよう！</p>

        <p class="text-slate-600 mb-4">
          この章で学んだことを、Xでアウトプットしましょう ✨
        </p>

        <button type="button"
                data-action="share#openTwitter"
                data-text="<%= "#{@section.heading} を学習しました！ #RailsLearning #Ruby #Rails" %>"
                class="btn-dark">
          Xでシェア
        </button>

        <p class="text-slate-600 mt-8 mb-4">対応するクイズに挑戦して理解を定着させましょう💡</p>

        <%= link_to "クイズを解く",
              quiz_section_path(@section.quiz_section.quiz, @section.quiz_section),
              class: "btn-pill is-red" %>
      </div>
    <% end %>
  </div>

  <div class="flex items-center justify-between mt-6 pt-6 border-t">
    <div>
      <% if @prev %>
        <%= link_to "◀ 前へ：#{@prev.heading}",
            book_section_path(@book, @prev),
            class: "text-slate-700 hover:underline" %>
      <% end %>
    </div>
    <div>
      <% if @next %>
        <%= link_to "次へ ▶：#{@next.heading}",
            book_section_path(@book, @next),
            class: "text-slate-700 hover:underline" %>
      <% end %>
    </div>
  </div>

  <% if can_edit?(@section) %>
    <div class="flex justify-end my-4">
      <%= link_to "編集", edit_book_section_path(@book, @section),
            class: "btn-change is-edit" %>
    </div>
  <% end %>
</div>
