<%# app/views/code_libraries/index.html.erb %>
<% content_for :title, "„Ç≥„Éº„Éâ„É©„Ç§„Éñ„É©„É™" %>

<!-- Ë¶ãÂá∫„Åó ‚Üí „Éï„Ç©„Éº„É†„ÇíÁ∏¶„Å´‰∏¶„Åπ„Çã -->
<div class="mb-4 space-y-3">
  <div>
    <h1 class="text-xl font-semibold"><%= yield :title %></h1>
  </div>

  <div>
    <%= form_with url: code_libraries_path, method: :get, class: "flex gap-2" do %>
      <%= text_field_tag :q, params[:q], placeholder: "„Ç≠„Éº„ÉØ„Éº„Éâ",
            class: "px-3 py-2 rounded ring-1 ring-slate-300 w-64 md:w-80" %>
      <%= select_tag :sort,
            options_for_select([["‰∫∫Ê∞óÈ†Ü","popular"],["Âà©Áî®Êï∞È†Ü","used"]], params[:sort]),
            class: "px-3 py-2 rounded ring-1 ring-slate-300" %>
      <%= submit_tag "Ê§úÁ¥¢", class: "px-3 py-2 rounded bg-slate-900 text-white" %>
    <% end %>
  </div>
</div>

<%# ---- ‰∏ÄË¶ß ---- %>
<% if @pre_codes.blank? %>
  <p class="text-slate-500">Ë©≤ÂΩì„Åô„Çã„Éá„Éº„Çø„Åå„ÅÇ„Çä„Åæ„Åõ„Çì„ÄÇ</p>
<% else %>
  <ul class="space-y-3">
    <% @pre_codes.each do |pc| %>
      <li class="border rounded-xl p-4">
        <div class="flex justify-between">
          <div>
            <div class="font-semibold"><%= link_to pc.title, code_library_path(pc) %></div>
            <p class="text-sm text-slate-500 mt-1"><%= truncate(pc.description, length: 100) %></p>
          </div>
          <div class="text-sm text-slate-500">
            üëç <%= pc.like_count %>„Éªüß∞ <%= pc.use_count %>
          </div>
        </div>
        <div class="mt-3">
          <% current_like = logged_in? ? pc.likes.find_by(user_id: current_user.id) : nil %>
          <%= render "actions", pre_code: pc, current_like: current_like %>
        </div>
      </li>
    <% end %>
  </ul>

  <div class="mt-6"><%= paginate @pre_codes %></div>
<% end %>
